<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Perfume Chatbot Popup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #fff9fc;
      margin: 0;
      min-height: 100vh;
    }

    /* í”Œë¡œíŒ… ì•„ì´ì½˜ */
    .chat-launcher {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: none;
      background: #d76da4;
      color: #fff;
      font-size: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
      z-index: 9999;
    }

    /* íŒì—… ì±—ë´‡ ë°•ìŠ¤ */
    .chat-popup {
      position: fixed;
      bottom: 84px;
      right: 20px;
      width: 360px;
      max-height: 560px;
      background: #fff;
      border-radius: 16px;
      border: 2px solid #f4d0e4;
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,0.2);
      z-index: 9998;
    }

    .chat-header {
      padding: 10px 14px;
      background: #d76da4;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
    }

    .chat-header-title {
      font-weight: 600;
    }

    .chat-header-close {
      border: none;
      background: transparent;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
    }

    .chat-window {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      background: #fffdfd;
    }

    .msg-row {
      margin-bottom: 10px;
      display: flex;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    .msg-bubble {
      padding: 10px 13px;
      max-width: 80%;
      border-radius: 12px;
      white-space: pre-line;
      font-size: 14px;
      line-height: 1.4;
    }

    .msg-bubble.user {
      background: #ffddee;
      border-bottom-right-radius: 2px;
    }

    .msg-bubble.bot {
      background: #f7e8f3;
      border-bottom-left-radius: 2px;
    }

    .input-area {
      display: flex;
      border-top: 1px solid #f0d5e5;
      background: #fff;
    }

    .input-area input {
      flex: 1;
      padding: 10px;
      border: none;
      font-size: 14px;
      outline: none;
    }

    .input-area button {
      width: 80px;
      border: none;
      background: #d76da4;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    @media (max-width: 480px) {
      .chat-popup {
        right: 10px;
        width: calc(100% - 20px);
      }
    }
  </style>
</head>
<body>

<!-- í”Œë¡œíŒ… ë²„íŠ¼ -->
<button class="chat-launcher" id="chat-launcher">ğŸ’¬</button>

<!-- íŒì—… ì±—ë´‡ -->
<div class="chat-popup" id="chat-popup">
  <div class="chat-header">
    <span class="chat-header-title">í–¥ìˆ˜ ì¶”ì²œ ì±—ë´‡</span>
    <button class="chat-header-close" id="chat-close">&times;</button>
  </div>

  <div id="chat-window" class="chat-window"></div>

  <div class="input-area">
    <input id="user-input" placeholder="í–¥ ëŠë‚Œì„ ì ì–´ì£¼ì„¸ìš”" />
    <button id="send-btn">ì „ì†¡</button>
  </div>
</div>

<script>
  // 10ê°œ í–¥ìˆ˜ ë°ì´í„°
  const perfumes = [
    { id:1, name:"01 First Memory",  keywords:["ìƒí¼","ì‹œíŠ¸ëŸ¬ìŠ¤","ë ˆëª¬","ì‚°ëœ»"], notes:["ë ˆëª¬","ë² ë¥´ê°€ëª»","ì‹œíŠ¸ëŸ¬ìŠ¤"] },
    { id:2, name:"02 Sweet Room",    keywords:["ë‹¬ì½¤","ë°”ë‹ë¼","ë¶€ë“œëŸ¬ìš´","í¬ê·¼"], notes:["ë°”ë‹ë¼","ë¨¸ìŠ¤í¬","ì¹´ë¼ë©œ"] },
    { id:3, name:"03 Rainy Day",     keywords:["ì‹œì›","ë§‘ì€","ë¹„ëˆ„í–¥","ì²­ëŸ‰","ê¹¨ë—"], notes:["ë¹„ëˆ„","í™”ì´íŠ¸ë¨¸ìŠ¤í¬"] },
    { id:4, name:"04 Wood Ground",   keywords:["ìš°ë””","ë‚˜ë¬´í–¥","ë¬µì§","ìŠ¤ëª¨í‚¤","ê¹Šì€"], notes:["ìƒŒë‹¬ìš°ë“œ","ì‹œë”","íŒŒì¶œë¦¬"] },
    { id:5, name:"05 Pink Mood",     keywords:["í”Œë¡œëŸ´","ê½ƒí–¥","ë¡œë§¨í‹±","ë¶€ë“œëŸ¬ì›€"], notes:["ì¥ë¯¸","ììŠ¤ë¯¼","í”¼ì˜¤ë‹ˆ"] },
    { id:6, name:"06 Fresh Day",     keywords:["ê³¼ì¼í–¥","ìƒí¼","ë‹¬ë‹¬","í†¡í†¡"], notes:["ë³µìˆ­ì•„","ë² ë¦¬","ì‚¬ê³¼"] },
    { id:7, name:"07 Deep Amber",    keywords:["ì— ë²„","ë¬µì§","ë”°ëœ»í•¨","ì„¹ì‹œ","ë†ë°€"], notes:["ì•°ë²„","íŒŒì¶œë¦¬"] },
    { id:8, name:"08 Soft Clean",    keywords:["ë¹„ëˆ„í–¥","ì½”íŠ¼","í¬ê·¼","ê¹”ë”","ì”ì”"], notes:["ì½”íŠ¼","í™”ì´íŠ¸ë¨¸ìŠ¤í¬","ë¦°ë„¨"] },
    { id:9, name:"09 Night Walk",    keywords:["ì”ì”","ê³ ìš”","ì°¨ë¶„","ì€ì€"], notes:["ì•„ì´ë¦¬ìŠ¤","í‹°","ë¨¸ìŠ¤í¬"] },
    { id:10,name:"10 Sunset Moment", keywords:["ë”°ëœ»","ë…¸ì„","ê°ì„±","í¸ì•ˆ"], notes:["ì˜¤ë Œì§€","ë°”ë‹ë¼","ë¨¸ìŠ¤í¬"] }
  ];

  // ë‚´ê°€ ë¬¶ì–´ë‘” ìœ ì‚¬ì–´ ê·¸ë£¹
  const synonymGroups = {
    "ìƒí¼":   ["ìƒí¼","ìƒì¾Œ","ì‚°ëœ»","ì‹œì›í•œìƒí¼","ë ˆëª¬ëŠë‚Œ","ì‹œíŠ¸ëŸ¬ìŠ¤"],
    "ë‹¬ì½¤":   ["ë‹¬ì½¤","ë‹¬ë‹¬","ìŠ¤ìœ—","ë””ì €íŠ¸í–¥"],
    "ë¶€ë“œëŸ¬ì›€":["ë¶€ë“œëŸ¬ì›€","ë¶€ë“œëŸ¬ìš´","í¬ê·¼","ì†Œí”„íŠ¸"],
    "ë¹„ëˆ„í–¥": ["ë¹„ëˆ„","ì†","ë¹„ëˆ„í–¥","ìƒ¤ì›Œí›„í–¥"],
    "ìš°ë””":   ["ìš°ë””","ë‚˜ë¬´","ìš°ë“œ","ìŠ¤ëª¨í‚¤","ë¬µì§"],
    "í”Œë¡œëŸ´": ["ê½ƒ","í”Œë¡œë„","í”Œë¡œëŸ´","ê½ƒí–¥","ë¡œë§¨í‹±"],
    "ë”°ëœ»":   ["ë”°ëœ»","ì›œ","ë…¸ì„","í¬ê·¼í•œë”°ëœ»"],
    "ê¹¨ë—":   ["ê¹¨ë—","í´ë¦°","ì²­ëŸ‰","ê¹”ë”"]
  };

  function cleanText(t) {
    return t.replace(/\s+/g, "").toLowerCase();
  }

  // ìœ ì‚¬ì–´ ê·¸ë£¹ ì•ˆì—ì„œ ë§¤ì¹­ë˜ëŠ”ì§€ ì²´í¬
  function matchSynonym(text, keyword) {
    for (const key in synonymGroups) {
      const group = synonymGroups[key];
      if (group.includes(keyword)) {
        if (group.some(g => text.includes(g))) return true;
      }
    }
    return false;
  }

  // ì¶”ì²œ ì ìˆ˜ ê³„ì‚°
  function getScores(userText) {
    const text = cleanText(userText);

    return perfumes.map(p => {
      let score = 0;

      // í‚¤ì›Œë“œ ì§ì ‘ ë§¤ì¹­ + ìœ ì‚¬ì–´ ë§¤ì¹­
      p.keywords.forEach(k => {
        if (text.includes(k)) score += 4;
        if (matchSynonym(text, k)) score += 3;
      });

      // ë…¸íŠ¸ë„ ë¹„ìŠ·í•˜ê²Œ ì²´í¬
      p.notes.forEach(n => {
        if (text.includes(n)) score += 3;
        if (matchSynonym(text, n)) score += 2;
      });

      // ì–´ê·¼ ê¸°ë°˜ ì²˜ë¦¬ (ëŒ€ì¶© ëŠë‚Œë§Œ ë§ì¶°ì¤Œ)
      if (/ë¶€ë“œ|í¬ê·¼|ìŠ¤ëª¨í‚¤|ìƒí¼|ê¹¨ë—/.test(text)) {
        if (p.keywords.some(k => text.includes(k.slice(0,2)))) score += 2;
      }

      return { ...p, score };
    }).sort((a,b) => b.score - a.score);
  }

  function recommend(text) {
    const list = getScores(text);

    if (!list.length || list[0].score === 0) {
      return "ì¡°ê¸ˆë§Œ ë” êµ¬ì²´ì ìœ¼ë¡œ ë§í•´ì¤˜! (ì˜ˆ: ìƒí¼í•œ ê³¼ì¼í–¥, í¬ê·¼í•œ ë¹„ëˆ„í–¥, ìš°ë””í•˜ê³  ë¬µì§í•œ í–¥)";
    }

    const a = list[0];
    const b = list[1];

    let msg = `"${a.name}" ì¶”ì²œ!\n`;
    if (b && b.score > 0) msg += `"${b.name}"ë„ ê°™ì´ í…ŒìŠ¤íŠ¸í•´ë³´ë©´ ì¢‹ì„ ë“¯.`;
    return msg;
  }

  // UI ê´€ë ¨
  const chatPopup   = document.getElementById("chat-popup");
  const launcher    = document.getElementById("chat-launcher");
  const closeBtn    = document.getElementById("chat-close");
  const chatWindow  = document.getElementById("chat-window");
  const input       = document.getElementById("user-input");
  const sendBtn     = document.getElementById("send-btn");

  function toggleChat(open) {
    if (open) {
      chatPopup.style.display = "flex";
    } else {
      chatPopup.style.display = "none";
    }
  }

  function addMsg(text, who) {
    const row = document.createElement("div");
    row.classList.add("msg-row", who);

    const bubble = document.createElement("div");
    bubble.classList.add("msg-bubble", who);
    bubble.textContent = text;

    row.appendChild(bubble);
    chatWindow.appendChild(row);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  function send() {
    const text = input.value.trim();
    if (!text) return;

    addMsg(text, "user");
    input.value = "";

    const reply = recommend(text);
    setTimeout(() => addMsg(reply, "bot"), 150);
  }

  // ì´ë²¤íŠ¸
  launcher.addEventListener("click", () => {
    const isOpen = chatPopup.style.display === "flex";
    toggleChat(!isOpen);
  });

  closeBtn.addEventListener("click", () => toggleChat(false));
  sendBtn.addEventListener("click", send);
  input.addEventListener("keydown", e => { if (e.key === "Enter") send(); });

  // ì²˜ìŒ ì•ˆë‚´ í•œ ì¤„
  addMsg("ì•ˆë…•! ì›í•˜ëŠ” í–¥ ëŠë‚Œì„ í¸í•˜ê²Œ ì ì–´ì¤˜.\nì˜ˆ) ìƒí¼í•œ ê³¼ì¼í–¥ / í¬ê·¼í•œ ë¹„ëˆ„í–¥ / ìš°ë””í•˜ê³  ë¬µì§í•œ ê²¨ìš¸ í–¥", "bot");
</script>

</body>
</html>
