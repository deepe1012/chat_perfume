<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Nostalgia Perfume Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
    }

    /* í”Œë¡œíŒ… ë²„íŠ¼ */
    .chat-launcher {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 58px;
      height: 58px;
      border-radius: 50%;
      border: none;
      background: #EADFCB;
      color: #fff;
      font-size: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.22);
      z-index: 99999;
    }

    /* íŒì—… ì „ì²´ */
    .chat-popup {
      position: fixed;
      bottom: 88px;
      right: 20px;
      width: 360px;
      max-height: calc(100vh - 120px);
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid #e6e6e6;
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 8px 22px rgba(0,0,0,0.18);
      z-index: 99998;
    }

    .chat-header {
      background: #ffffff;
      padding: 12px 14px;
      border-bottom: 1px solid #efefef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header-title {
      font-weight: 600;
      font-size: 15px;
      color: #333;
    }

    .chat-header-sub {
      font-size: 11px;
      color: #999;
      margin-top: 2px;
    }

    .chat-header-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #666;
    }

    .chat-window {
      flex: 1;
      padding: 10px 12px;
      overflow-y: auto;
      background: #fafafa;
    }

    .msg-row {
      margin-bottom: 10px;
      display: flex;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    .msg-bubble {
      padding: 10px 13px;
      max-width: 78%;
      font-size: 13px;
      line-height: 1.45;
      border-radius: 14px;
      white-space: pre-line;
    }

    .msg-bubble.bot {
      background: #f2f2f2;
      border-bottom-left-radius: 4px;
    }

    .msg-bubble.user {
      background: #ffe5f4;
      border-bottom-right-radius: 4px;
    }

    .msg-bubble.bot b {
      font-size: 13px;
    }

    .quick-menu {
      background: #ffffff;
      padding: 6px 6px;
      border-top: 1px solid #ececec;
      border-bottom: 1px solid #ececec;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .quick-chip {
      border: none;
      padding: 5px 10px;
      border-radius: 999px;
      background: #f1f1f1;
      color: #666;
      font-size: 11px;
      cursor: pointer;
      white-space: nowrap;
    }

    .input-area {
      display: flex;
      border-top: 1px solid #eaeaea;
      background: #ffffff;
    }

    .input-area input {
      flex: 1;
      border: none;
      padding: 12px;
      font-size: 13px;
      outline: none;
    }

    .input-area button {
      width: 80px;
      border: none;
      background: #d76da4;
      color: #fff;
      cursor: pointer;
      font-size: 13px;
    }

    .product-link {
      display: inline-block;
      margin-top: 8px;
      padding: 5px 10px;
      border-radius: 8px;
      background: #ffffff;
      border: 1px solid #d9bfd0;
      font-size: 11px;
      text-decoration: none;
      color: #b75d8d;
    }

    .helper-text {
      font-size: 11px;
      color: #888;
      margin-bottom: 6px;
    }
  </style>
</head>
<body>

<button class="chat-launcher" id="chat-launcher">ğŸ’¬</button>

<div class="chat-popup" id="chat-popup">
  <div class="chat-header">
    <div>
      <div class="chat-header-title">ì¶”ì–µì˜ í–¥ìˆ˜ ì±—ë´‡</div>
      <div class="chat-header-sub">ê·¸ë•Œ ê·¸ ìˆœê°„ì„ í–¥ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¬ê²Œìš”</div>
    </div>
    <button class="chat-header-close" id="chat-close">Ã—</button>
  </div>

  <div class="chat-window" id="chat-window">
    <div class="helper-text">
      ì˜ˆ: "ë¹„ ì˜¤ëŠ” ë‚  í™ëƒ„ìƒˆ", "4ì›” ì²«ì‚¬ë‘", "ì—„ë§ˆì˜ ë¶€ì—Œ ê°™ì€ í–¥", "ë¸Œëœë“œ ì†Œê°œ", "ì¥ë§ˆì˜ ê¸°ì–µ ì„¤ëª…í•´ì¤˜"
    </div>
  </div>

  <div class="quick-menu">
    <button class="quick-chip" data-text="ë¸Œëœë“œ ì†Œê°œí•´ì¤˜">ë¸Œëœë“œ ì†Œê°œ</button>
    <button class="quick-chip" data-text="í–¥ìˆ˜ ë¦¬ìŠ¤íŠ¸ ë³´ì—¬ì¤˜">í–¥ìˆ˜ ë¦¬ìŠ¤íŠ¸</button>
    <button class="quick-chip" data-text="ë¹„ ì˜¤ëŠ” ë‚  ê°™ì€ í–¥ ì¶”ì²œí•´ì¤˜">ë¹„ ì˜¤ëŠ” ë‚ </button>
    <button class="quick-chip" data-text="ë²šê½ƒ ê°™ì€ ì²«ì‚¬ë‘ í–¥ ì¶”ì²œí•´ì¤˜">4ì›”ì˜ ì²«ì‚¬ë‘</button>
    <button class="quick-chip" data-text="ì—„ë§ˆì˜ ë¶€ì—Œ ê°™ì€ í–¥ ì¶”ì²œí•´ì¤˜">ì—„ë§ˆì˜ ë¶€ì—Œ</button>
    <button class="quick-chip" data-text="í•™êµ êµì‹¤ ê°™ì€ í–¥ ì¶”ì²œí•´ì¤˜">êµì‹¤ ëŠë‚Œ</button>
    <button class="quick-chip" data-text="ìš´ë™ì¥ í™ëƒ„ìƒˆ ë‚˜ëŠ” í–¥ ì¶”ì²œí•´ì¤˜">ìš´ë™ì¥/í™ëƒ„ìƒˆ</button>
    <button class="quick-chip" data-text="êµ¬ë©ê°€ê²Œ ì‚¬íƒ• ê°™ì€ í–¥ ì¶”ì²œí•´ì¤˜">êµ¬ë©ê°€ê²Œ ì‚¬íƒ•</button>
  </div>

  <div class="input-area">
    <input id="user-input" placeholder="ë– ì˜¬ë¦¬ê³  ì‹¶ì€ ì¥ë©´ì´ë‚˜ ê°ì •ì„ ì ì–´ì£¼ì„¸ìš”" />
    <button id="send-btn">ì „ì†¡</button>
  </div>
</div>

<script>
  // --- í–¥ìˆ˜ ë°ì´í„° 12ì¢… ---
  const perfumes = [
    {
      id: 1,
      name: "ì˜¤í›„ 4ì‹œì˜ êµì‹¤",
      frName: "Seize Heures en Classe",
      reference: "í‚¬ë¦¬ì•ˆ ìŠ¤íŠ¸ë ˆì´íŠ¸ íˆ¬ í—¤ë¸ ë§ˆì§€ë§‰",
      story: "ì¢…ì´ ìš¸ë¦¬ê³  ë‚œ ë’¤ì˜ ê³ ìš”í•¨. ë¶„í•„ ê°€ë£¨ê°€ í–‡ì‚´ì— ë°˜ì§ì´ë˜ ê·¸ ìˆœê°„. ì°½ë¬¸ ë„ˆë¨¸ë¡œ ë“¤ì–´ì˜¤ë˜ ì•„ì¹´ì‹œì•„ í–¥ê³¼ ë‚¡ì€ ì±…ìƒì˜ ë‚˜ë¬´ ëƒ„ìƒˆ, ê·¸ë¦¬ê³  ì¹œêµ¬ë“¤ê³¼ ë‚˜ëˆ  ë¨¹ë˜ ìš°ìœ ì˜ ë‹¬ì½¤í•¨ì„ ë‹´ì€ í–¥ì…ë‹ˆë‹¤.",
      notes: ["í™”ì´íŠ¸ ë¨¸ìŠ¤í¬", "ìš°ë””", "ë°”ë‹ë¼", "ì•„ì¹´ì‹œì•„"],
      mood: ["ë”°ëœ»í•¨", "í–‡ì‚´", "ë¶„í•„", "ë…¸ì„", "êµì‹¤", "í•™êµ", "í¬ê·¼í•¨", "ìš°ìœ ", "í¸ì•ˆ"],
      memory: ["í•™ì°½ì‹œì ˆ", "ì˜¤í›„ 4ì‹œ", "ìˆ˜ì—… ë", "ì¹œêµ¬ë“¤ê³¼ ìˆ˜ë‹¤", "ì°½ê°€ í–‡ì‚´"],
      keywords: ["êµì‹¤","ì¹ íŒ","ë¶„í•„","í–‡ì‚´","ë…¸ì„","ë”°ëœ»","í¬ê·¼","ìš°ë””","ë°”ë‹ë¼","í™”ì´íŠ¸ë¨¸ìŠ¤í¬","ì•„ì¹´ì‹œì•„","í•™êµ","ìˆ˜ì—…ë"],
      link: "" // ë‚˜ì¤‘ì— ì¹´í˜24 ìƒí’ˆ ë§í¬ ë„£ìœ¼ë©´ ë¨
    },
    {
      id: 2,
      name: "ìƒ‰ì¢…ì´ í¸ì§€",
      frName: "Lettre en Origami",
      reference: "ë¥´ ë©”ì‚¬ì œ",
      story: "ì†ë•Œ ë¬»ì€ ìƒ‰ì¢…ì´ë¥¼ ì ‘ìœ¼ë©° ì „í•˜ë˜ ë¹„ë°€ ë©”ì‹œì§€ë“¤. ì¢…ì´ì˜ ë°”ìŠ¤ë½ê±°ë¦¼ê³¼ ì‰í¬ì˜ ë‹¬ì½¤ìŒ‰ì‹¸ë¦„í•œ ëƒ„ìƒˆê°€ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["í˜ì´í¼", "ì•„ì´ë¦¬ìŠ¤", "ì‹œíŠ¸ëŸ¬ìŠ¤"],
      mood: ["ì„¤ë ˜", "ì¢…ì´", "í¸ì§€", "ì²«ì‚¬ë‘", "ë‹¬ì½¤ìŒ‰ì‹¸ë¦„", "ì‰í¬"],
      memory: ["ëª°ë˜ ì ë˜ ìª½ì§€", "ì¹œêµ¬ì™€ ìš°ì •", "ìƒ‰ì¢…ì´ ì ‘ê¸°"],
      keywords: ["ìƒ‰ì¢…ì´","í¸ì§€","ìª½ì§€","ë°”ìŠ¤ë½","ì¢…ì´ëƒ„ìƒˆ","ì‰í¬","ìš°ì •","ì²«ì‚¬ë‘","ì•„ì´ë¦¬ìŠ¤","ì‹œíŠ¸ëŸ¬ìŠ¤"],
      link: ""
    },
    {
      id: 3,
      name: "ê³¨ëª©ê¸¸ ë ì§€í•˜ì‹¤",
      frName: "Cave SecrÃ¨te",
      reference: "ì—ë”° í—¤ë¥´ë§Œ",
      story: "ë™ë„¤ ê³¨ëª©ê¸¸ êµ¬ì„ì˜ ë¹„ë°€ ì•„ì§€íŠ¸. ìŠµê¸° ì–´ë¦° ê³µê¸°ì™€ ì˜¤ë˜ëœ ì½˜í¬ë¦¬íŠ¸, ë¨¼ì§€ ìŒ“ì¸ ë³´ë¬¼ ê°™ì€ ë§Œí™”ì±…ë“¤. ì–´ë‘‘í•œ ê³µê°„ì—ì„œë§Œ ë‚˜ëˆŒ ìˆ˜ ìˆì—ˆë˜ ì•„ì´ë“¤ë§Œì˜ ë¹„ë°€ìŠ¤ëŸ¬ìš´ ì‹œê°„ì„ ë‹´ì€ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ë¨¸ìŠ¤í‚¤í•œ í™ë‚´ìŒ", "ì½˜í¬ë¦¬íŠ¸", "ëª¨ìŠ¤"],
      mood: ["ë¹„ë°€ìŠ¤ëŸ¬ì›€", "ìŠµê¸°", "ì°¨ê°€ì›€", "ì§€í•˜ì‹¤", "ì½˜í¬ë¦¬íŠ¸"],
      memory: ["ì•„ì§€íŠ¸", "ì–´ë‘‘í•œ ê³µê°„", "ìˆ¨ê²¨ë‘” ì¥ë‚œê°"],
      keywords: ["ì§€í•˜ì‹¤","ì•„ì§€íŠ¸","ë¹„ë°€","ë¨¸ìŠ¤í¬","ëª¨ìŠ¤","í™ëƒ„ìƒˆ","ì½˜í¬ë¦¬íŠ¸","ìŠµí•œ","ê³¨ëª©ê¸¸"],
      link: ""
    },
    {
      id: 4,
      name: "í• ë¨¸ë‹ˆì˜ ì„œëì¥",
      frName: "Tiroir de Grand-mÃ¨re",
      reference: "ë”¥í‹°í¬ ë¡œ íŒŒí”¼ì—",
      story: "ì˜¤ë˜ëœ ì¥ë¡±ì„ ì—´ ë•Œë§ˆë‹¤ í’ê¸°ë˜ ê³ ì¦ˆë„‰í•œ í•œì§€ ëƒ„ìƒˆ. ëª…ì ˆ í•œë³µ, í• ë¨¸ë‹ˆì˜ ì†ë•Œ ë¬»ì€ í¸ì§€ë“¤. ì‹œê°„ì´ ë§Œë“  ê¹Šì´ ìˆëŠ” ì¢…ì´ í–¥ê³¼ ë”°ëœ»í•œ ë‚˜ë¬´ í–¥ì´ ì–´ìš°ëŸ¬ì§„ í–¥ì…ë‹ˆë‹¤.",
      notes: ["íŒŒí”¼ë£¨ìŠ¤", "ì‚¼ë‚˜ë¬´", "í”Œë¡œëŸ´"],
      mood: ["ê³ ì¦ˆë„‰í•¨", "ì¢…ì´", "ì „í†µ", "í•œë³µ", "ë‚˜ë¬´í–¥"],
      memory: ["í• ë¨¸ë‹ˆì§‘", "ì„œëì¥", "í¸ì§€ë­‰ì¹˜"],
      keywords: ["í• ë¨¸ë‹ˆ","ì„œëì¥","í•œì§€","ì¢…ì´","íŒŒí”¼ë£¨ìŠ¤","ì‚¼ë‚˜ë¬´","í”Œë¡œëŸ´","ì „í†µ","ëª…ì ˆ","ì¥ë¡±"],
      link: ""
    },
    {
      id: 5,
      name: "ì—„ë§ˆì˜ ë¶€ì—Œ",
      frName: "Cuisine de Maman",
      reference: "ë”¥í‹°í¬ ë¡œ íŒŒí”¼ì—",
      story: "í•™êµì—ì„œ ëŒì•„ì˜¬ ë•Œë§ˆë‹¤ í˜„ê´€ë¬¸ì„ ì—´ë©´ í’ê¸°ë˜ êµ¬ìˆ˜í•œ ëƒ„ìƒˆ, ì••ë ¥ë°¥ì†¥ì—ì„œ ê¹€ì´ ëª¨ë½ëª¨ë½ í”¼ì–´ì˜¤ë¥´ê³ , ë”°ëœ»í•œ ë°¥ í•œ ê³µê¸°ì— ì°¸ê¸°ë¦„ì„ ë‘˜ëŸ¬ ë¹„ë²¼ì£¼ì‹œë˜ ì—„ë§ˆì˜ ì†ê¸¸ì´ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["í† ìŠ¤í‹°ë“œ ë¼ì´ìŠ¤", "ë”°ëœ»í•œ ìš°ë””", "ì°¸ê¸°ë¦„"],
      mood: ["ë”°ëœ»í•¨", "ì§‘ë°¥", "í¸ì•ˆ", "ê³ ì†Œí•¨"],
      memory: ["ì—„ë§ˆì˜ ë°¥", "í˜„ê´€ ì—´ìë§ˆì ë‚˜ëŠ” ëƒ„ìƒˆ", "ì§‘ì˜ ê³µê¸°"],
      keywords: ["ì§‘ë°¥","ë°¥ëƒ„ìƒˆ","ì••ë ¥ë°¥ì†¥","ì°¸ê¸°ë¦„","ë¶€ì—Œ","ì£¼ë°©","ë”°ëœ»","ê³ ì†Œ","ì—„ë§ˆ","ë°¥"],
      link: ""
    },
    {
      id: 6,
      name: "êµ¬ë©ê°€ê²Œ ì‚¬íƒ•",
      frName: "Bonbons du Coin",
      reference: "í´ë¦° ì• í”Œ ë¸”ë¡œì¸",
      story: "100ì›, 200ì› ë™ì „ì„ ì¥ê³  ë‹¬ë ¤ê°€ë˜ ê³¨ëª©ê¸¸ êµ¬ë©ê°€ê²Œ. ìœ ë¦¬ë³‘ ì† ì•Œë¡ë‹¬ë¡í•œ ì‚¬íƒ•ë“¤ê³¼ ì«€ë“í•œ ì ¤ë¦¬, ìƒˆì½¤ë‹¬ì½¤í•œ ì‚¬ê³¼ë§› ë§‰ëŒ€ì‚¬íƒ•. ì–´ë¦° ì‹œì ˆ ê°€ì¥ ë‹¬ì½¤í–ˆë˜ í–‰ë³µì˜ ë§›ì´ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ì• í”Œ ë¸”ë¡œì¸", "ìº”ë””", "ì‹œíŠ¸ëŸ¬ìŠ¤"],
      mood: ["ë‹¬ì½¤í•¨", "ì¦ê±°ì›€", "í†¡í†¡ íŠ€ëŠ” ëŠë‚Œ"],
      memory: ["100ì› ì‚¬íƒ•", "ê³¨ëª©ê¸¸", "êµ¬ë©ê°€ê²Œ"],
      keywords: ["ì‚¬íƒ•","êµ¬ë©ê°€ê²Œ","ì ¤ë¦¬","ë§‰ëŒ€ì‚¬íƒ•","ì‚¬ê³¼ë§›","ì• í”Œ","ìº”ë””","ìƒˆì½¤ë‹¬ì½¤","ê°„ì‹","100ì›"],
      link: ""
    },
    {
      id: 7,
      name: "4ì›”ì˜ ì²«ì‚¬ë‘",
      frName: "Romance d'Avril",
      reference: "",
      story: "ë´„ë°”ëŒì— ë‚ ë¦¬ë˜ ë²šê½ƒìì²˜ëŸ¼ ì„¤ë œë˜ ì²«ì‚¬ë‘. ë³µë„ì—ì„œ ë§ˆì£¼ì¹ ê¹Œ ë‘ê·¼ê±°ë¦¬ë˜ ì‹¬ì¥ ì†Œë¦¬, ëª°ë˜ ì „í•´ë°›ì€ ìª½ì§€, ê·¸ë¦¬ê³  ì´ë¦„ ì„ ìë§Œ ë“¤ì–´ë„ ì–¼êµ´ì´ ë¹¨ê°œì§€ë˜ ê·¸ ì‹œì ˆ. ì²­ìˆœí•˜ê³  í’‹í’‹í•œ ë´„ê½ƒ í–¥ê¸°ê°€ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ì²´ë¦¬ ë¸”ë¡œì¸", "í™”ì´íŠ¸ í”Œë¡œëŸ´", "ì†Œí”„íŠ¸ ë¨¸ìŠ¤í¬"],
      mood: ["ì„¤ë ˜", "ë²šê½ƒ", "ë‘ê·¼ê±°ë¦¼", "ë´„ë°”ëŒ"],
      memory: ["ë³µë„ì—ì„œ ë§ˆì£¼ì¹˜ë˜ ìˆœê°„", "ìª½ì§€", "ì²«ì‚¬ë‘"],
      keywords: ["ë²šê½ƒ","ì²«ì‚¬ë‘","ì²´ë¦¬ë¸”ë¡œì¸","í”Œë¡œëŸ´","ë¨¸ìŠ¤í¬","ë´„","ë‘ê·¼","ì—°ì• ì‹œì‘","ì„¤ë ˜"],
      link: ""
    },
    {
      id: 8,
      name: "ì†Œí’ ê°€ëŠ” ë‚ ",
      frName: "Jour de Pique-nique",
      reference: "",
      story: "ë„ì‹œë½ ì‹¸ë“¤ê³  ë– ë‚˜ë˜ ë´„ ì†Œí’. ë²„ìŠ¤ ì°½ë¬¸ìœ¼ë¡œ ë³´ì´ë˜ ì‹ ë¡ì˜ ì‚°ê³¼ ë§‘ì€ ê³µê¸°. ì¹œêµ¬ë“¤ê³¼ ë‚˜ëˆ  ë¨¹ë˜ ê¹€ë°¥, ì‚° ì •ìƒì—ì„œ ë§ˆì‹œë˜ ì‹œì›í•œ ë¬¼ì˜ ì²­ëŸ‰í•¨. ìì—° ì†ì—ì„œ ë§ˆìŒê» ë›°ë†€ë˜ ììœ ë¡œì›€ì´ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ê·¸ë¦° í‹°", "ì‹œë”ìš°ë“œ", "í”„ë ˆì‹œ ì—ì–´"],
      mood: ["ììœ ë¡œì›€", "ìƒì¾Œ", "ì•¼ì™¸", "í–‡ì‚´"],
      memory: ["ê¹€ë°¥", "ì†Œí’ë²„ìŠ¤", "ì‹ ë¡ì˜ ì‚°"],
      keywords: ["ì†Œí’","ì†Œí’ë²„ìŠ¤","ê¹€ë°¥","ë´„ì‚°","ì‹ ë¡","ê·¸ë¦°í‹°","ë§‘ì€ê³µê¸°","í”„ë ˆì‹œ","ì—¬í–‰ì‹œì‘"],
      link: ""
    },
    {
      id: 9,
      name: "ì—¬ë¦„ ë°”ìº‰ìŠ¤",
      frName: "Vacances d'Ã‰tÃ©",
      reference: "",
      story: "ì—¬ë¦„ë°©í•™ ë°”ë‹·ê°€ë¡œ ë– ë‚˜ë˜ ê°€ì¡±ì—¬í–‰. ëœ¨ê±°ìš´ ëª¨ë˜ì‚¬ì¥ê³¼ ì‹œì›í•œ íŒŒë„ ì†Œë¦¬, ìˆ˜ë°•ê³¼ ì•„ì´ìŠ¤í¬ë¦¼ì˜ ë‹¬ì½¤í•¨. ì„ í¬ë¦¼ ëƒ„ìƒˆì™€ ë°”ë‹¤ ë‚´ìŒì´ ì„ì¸ ì—¬ë¦„ë‚ ì˜ ììœ ë¡œì›€ì´ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ì†”í‹° ì˜¤ì…˜", "ì½”ì½”ë„›", "ì‹œíŠ¸ëŸ¬ìŠ¤"],
      mood: ["ììœ ", "ì²­ëŸ‰", "ì—¬ë¦„", "ì‹œì›í•¨"],
      memory: ["ê°€ì¡±ì—¬í–‰", "ë°”ë‹·ê°€", "ìˆ˜ë°•", "ì•„ì´ìŠ¤í¬ë¦¼"],
      keywords: ["ë°”ë‹¤","í•´ë³€","ëª¨ë˜ì‚¬ì¥","ì„ í¬ë¦¼","íŒŒë„","ì½”ì½”ë„›","ì—¬ë¦„íœ´ê°€","ë°”ìº‰ìŠ¤","ìˆ˜ë°•","ì•„ì´ìŠ¤í¬ë¦¼"],
      link: ""
    },
    {
      id: 10,
      name: "ìš´ë™ì¥ì˜ ë´„",
      frName: "Printemps au Stade",
      reference: "",
      story: "ì²­íŒ€, ë°±íŒ€ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ë›°ë˜ ìš´ë™íšŒ. ë´„ë³• ì•„ë˜ í™ë¨¼ì§€ê°€ ë‚ ë¦¬ë˜ ìš´ë™ì¥, ë•€ í˜ë¦¬ë©° ë‹¬ë¦¬ë˜ ê³„ì£¼, ê·¸ë¦¬ê³  ì‘ì›ì„ì—ì„œ ë‚˜ëˆ  ë¨¹ë˜ ê°„ì‹ë“¤. í™œê¸°ì°¬ í•¨ì„±ê³¼ í’€ ë‚´ìŒì´ ì–´ìš°ëŸ¬ì§„ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ê·¸ë¼ìŠ¤", "ì–´ìŠ¤", "ìŠ¤í¬í‹° ë…¸íŠ¸"],
      mood: ["í™œê¸°ì°¸", "ìŠ¤í¬í‹°", "í–‡ì‚´", "ììœ ë¡œì›€"],
      memory: ["ìš´ë™íšŒ", "ê³„ì£¼", "ê°„ì‹"],
      keywords: ["ìš´ë™ì¥","ìš´ë™íšŒ","ì²´ìœ¡ëŒ€íšŒ","í™ë¨¼ì§€","ê·¸ë¼ìŠ¤","ìŠ¤í¬í‹°","ì‘ì›","ë‹¬ë¦¬ê¸°","í’€ëƒ„ìƒˆ"],
      link: ""
    },
    {
      id: 11,
      name: "í’€ë°­ ìœ„ ì˜¤í›„",
      frName: "AprÃ¨s-midi dans l'Herbe",
      reference: "",
      story: "í•™êµ ë’¤ëœ° í’€ë°­ì— ë“œëŸ¬ëˆ„ì›Œ í•˜ëŠ˜ì„ ë³´ë˜ ì˜¤í›„. í’€ìì„ ì”¹ìœ¼ë©´ ë‚˜ë˜ í’‹í’‹í•œ ë§›, ì• ê¸°ë˜¥í’€ì˜ ë…¸ë€ ì¦™, í´ë¡œë²„ ê½ƒì„ ì—®ì–´ ë§Œë“  í™”ê´€. ìì—°ì´ ì£¼ë˜ ì†Œë°•í•œ í–‰ë³µì´ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["ê·¸ë¦° ë¦¬í”„", "í´ë¡œë²„", "í”„ë ˆì‹œ í—ˆë¸Œ"],
      mood: ["ìì—°", "í¸ì•ˆ", "ì´ˆë¡", "í’€í–¥"],
      memory: ["ë„¤ìí´ë¡œë²„", "ë’¹êµ´ê¸°", "í•˜ëŠ˜ë³´ê¸°"],
      keywords: ["í’€ë°­","ì”ë””","í´ë¡œë²„","í—ˆë¸Œ","ê·¸ë¦°","ìì—°","ë°©ê³¼í›„","í•˜ëŠ˜ë³´ê¸°","ì—¬ìœ "],
      link: ""
    },
    {
      id: 12,
      name: "ì¥ë§ˆì˜ ê¸°ì–µ",
      frName: "MÃ©moire de Mousson",
      reference: "",
      story: "ì¥ë§ˆì²  ì¶•ì¶•í•œ ê³µê¸°ì™€ ë¹—ë°©ìš¸ì´ ì°½ë¬¸ì„ ë‘ë“œë¦¬ë˜ ì†Œë¦¬. ë¹„ ê·¸ì¹œ ë’¤ í”¼ì–´ì˜¤ë¥´ë˜ í™ë‚´ìŒ, ì –ì€ ì•„ìŠ¤íŒ”íŠ¸ì™€ í’€ ëƒ„ìƒˆ. ìš°ì‚° ì—†ì´ ë¹„ë¥¼ ë§ìœ¼ë©° ë›°ì–´ë‹¤ë‹ˆë˜ ì² ì—†ë˜ ì‹œì ˆì˜ ììœ ë¡œì›€ì´ ë‹´ê¸´ í–¥ì…ë‹ˆë‹¤.",
      notes: ["í˜íŠ¸ë¦¬ì½”ë¥´", "ì˜¤ì¡´", "ì•„ì¿ ì•„í‹±"],
      mood: ["ì´‰ì´‰í•¨", "ê³ ìš”í•¨", "ë¹„", "ì°¨ë¶„"],
      memory: ["ë¹—ì†Œë¦¬", "ì¥ë§ˆ", "ì –ì€ í™", "ìš°ì‚° ì—†ì´ ë›°ê¸°"],
      keywords: ["ë¹„","ì¥ë§ˆ","ë¹—ì†Œë¦¬","ìš°ì‚°","ì†Œë‚˜ê¸°","í™ë‚´ìŒ","ì –ì€ì•„ìŠ¤íŒ”íŠ¸","ì´‰ì´‰","ì•„ì¿ ì•„í‹±","í˜íŠ¸ë¦¬ì½”ë¥´"],
      link: ""
    }
  ];

  // ê°ì •/ìƒí™© í´ëŸ¬ìŠ¤í„°
  const emotionClusters = [
    { name: "ë”°ëœ»í•¨", words: ["ë”°ëœ»","í¬ê·¼","ì•„ëŠ‘","ì§‘ê°™","í¸ì•ˆ"], targetIds: [1,4,5] },
    { name: "ì²«ì‚¬ë‘", words: ["ì²«ì‚¬ë‘","ì„¤ë ˜","ë‘ê·¼","ì‹¬ì¥","ì—°ì• "], targetIds: [2,7] },
    { name: "ë¹„ì˜¤ëŠ”ë‚ ", words: ["ë¹„","ì¥ë§ˆ","ì†Œë‚˜ê¸°","ë¹—ì†Œë¦¬","ì´‰ì´‰","ìš°ì‚°"], targetIds: [3,12] },
    { name: "ë°”ë‹¤", words: ["ë°”ë‹¤","í•´ë³€","íŒŒë„","ì„œí•‘","ë¬¼ë†€ì´","ë°”ìº‰ìŠ¤","íœ´ê°€"], targetIds: [9] },
    { name: "í•™êµ", words: ["í•™êµ","êµì‹¤","ì¹ íŒ","ë¶„í•„","ìˆ˜ì—…","ì¢…ì¹˜"], targetIds: [1,2,10,11] },
    { name: "ì§‘ë°¥", words: ["ì§‘ë°¥","ë°¥","ë¶€ì—Œ","ì£¼ë°©","ì—„ë§ˆ","í˜„ê´€ë¬¸"], targetIds: [5] },
    { name: "ì†Œí’", words: ["ì†Œí’","ì†Œí’ë²„ìŠ¤","í”¼í¬ë‹‰","ë„ì‹œë½","ê¹€ë°¥","ì—¬í–‰ì‹œì‘"], targetIds: [8] },
    { name: "ìš´ë™ì¥", words: ["ìš´ë™ì¥","ìš´ë™íšŒ","ì²´ìœ¡ëŒ€íšŒ","ê³„ì£¼","íŠ¸ë™","ì‘ì›"], targetIds: [10] },
    { name: "ì‚¬íƒ•", words: ["ì‚¬íƒ•","ìº”ë””","ì ¤ë¦¬","ë§‰ëŒ€ì‚¬íƒ•","ë‹¬ë‹¬","ë‹¬ì½¤"], targetIds: [6] },
    { name: "í’€ë°­", words: ["í’€ë°­","ì”ë””","í´ë¡œë²„","ì´ˆë¡","ë„¤ìí´ë¡œë²„"], targetIds: [11] }
  ];

  function norm(str) {
    return str.replace(/\s+/g, "").toLowerCase();
  }

  function findPerfumeByText(text) {
    const t = text.toLowerCase();
    const noSpace = norm(text);

    const numMatch = t.match(/(\d+)\s*ë²ˆ/);
    if (numMatch) {
      const id = parseInt(numMatch[1], 10);
      const found = perfumes.find(p => p.id === id);
      if (found) return found;
    }

    for (const p of perfumes) {
      if (
        t.includes(p.name.toLowerCase()) ||
        t.includes(p.frName.toLowerCase()) ||
        noSpace.includes(norm(p.name)) ||
        noSpace.includes(norm(p.frName))
      ) {
        return p;
      }
    }
    return null;
  }

  function scorePerfumes(userText) {
    const t = userText.toLowerCase();
    const tNorm = norm(userText);

    return perfumes.map(p => {
      let score = 0;

      // í‚¤ì›Œë“œ, mood, memory, notes ì§ì ‘ ë§¤ì¹­
      p.keywords.forEach(k => {
        if (tNorm.includes(norm(k))) score += 9;
      });
      p.mood.forEach(m => {
        if (t.includes(m)) score += 6;
      });
      p.memory.forEach(m => {
        if (t.includes(m)) score += 5;
      });
      p.notes.forEach(n => {
        if (t.includes(n.toLowerCase())) score += 4;
      });

      // ê°ì •/ìƒí™© í´ëŸ¬ìŠ¤í„° ë§¤ì¹­
      emotionClusters.forEach(cluster => {
        const hit = cluster.words.some(w => t.includes(w));
        if (hit && cluster.targetIds.includes(p.id)) {
          score += 7;
        }
      });

      // í†¤ì´ ì”ì”/ì°¨ë¶„/ê³ ìš” â†’ ì¥ë§ˆ/í’€ë°­ ê³„ì—´ ê°€ì¤‘
      if (/ì”ì”|ì°¨ë¶„|ê³ ìš”|ì¡°ìš©|ì€ì€/.test(t)) {
        if ([11, 12, 1].includes(p.id)) score += 3;
      }
      // í™œê¸°/ì—ë„ˆì§€ â†’ ìš´ë™ì¥/ë°”ìº‰ìŠ¤/ì†Œí’
      if (/í™œê¸°|ì—ë„ˆì§€|ì‹ ë‚¨|ì‹ ë‚˜ëŠ”|ë›°ì–´/.test(t)) {
        if ([8, 9, 10, 6].includes(p.id)) score += 3;
      }

      // ì™„ì „ ì• ë§¤í•œ ì…ë ¥ì¼ ë•Œë„ ì–´ëŠ ì •ë„ ëœë¤ ê°€ì¤‘ì¹˜
      if (score === 0) {
        score += Math.floor(Math.random() * 5); // 0~4
      }

      return { ...p, score };
    }).sort((a, b) => b.score - a.score);
  }

  function buildBrandIntroHtml() {
    return `
<b>ì¶”ì–µì˜ í–¥ìˆ˜ëŠ” ì–´ë–¤ ë¸Œëœë“œì¸ê°€ìš”?</b><br><br>
ìš°ë¦¬ëŠ” ë‹¨ìˆœíˆ ì¢‹ì€ ëƒ„ìƒˆë¥¼ íŒŒëŠ” ë¸Œëœë“œê°€ ì•„ë‹ˆë¼,<br>
<b>"ë‹¹ì‹ ì˜ ê¸°ì–µì„ í–¥ìœ¼ë¡œ ê¸°ë¡í•˜ëŠ” ì‘ì€ ì•„ì¹´ì´ë¸Œ"</b>ë¥¼ ë§Œë“œëŠ” ë¸Œëœë“œì˜ˆìš”.<br><br>
í•™ì°½ì‹œì ˆ êµì‹¤, êµ¬ë©ê°€ê²Œ ì‚¬íƒ•, ì—„ë§ˆì˜ ë¶€ì—Œ, ì¥ë§ˆ ë í™ëƒ„ìƒˆì²˜ëŸ¼<br>
ìŠê³  ì‚´ë˜ ì¥ë©´ë“¤ì„ ë‹¤ì‹œ êº¼ë‚´ë³¼ ìˆ˜ ìˆë„ë¡,<br>
ê° í–¥ìˆ˜ë§ˆë‹¤ í•˜ë‚˜ì˜ <b>í•œêµ­ì‹ ì¶”ì–µ</b>ì„ ë‹´ì•„ë‘ì—ˆì–´ìš”.<br><br>
ì›í•˜ëŠ” ìˆœê°„ì´ë‚˜ ê¸°ë¶„ì„ ë§í•´ì£¼ë©´,<br>
ê·¸ ê¸°ì–µì— ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” í–¥ì„ ê³¨ë¼ì¤„ê²Œìš”. âœ¨
`;
  }

  function buildListHtml() {
    const lines = perfumes.map(p => `${p.id}. ${p.name} (${p.frName})`);
    return `<b>í˜„ì¬ ì»¬ë ‰ì…˜ 12ì¢…ì´ì—ìš”.</b><br><br>${lines.join("<br>")}<br><br>ê¶ê¸ˆí•œ í–¥ì´ ìˆë‹¤ë©´<br>"3ë²ˆ ì„¤ëª…í•´ì¤˜" ë˜ëŠ” "ì¥ë§ˆì˜ ê¸°ì–µ ì„¤ëª…í•´ì¤˜"ì²˜ëŸ¼ ë¬¼ì–´ë´ë„ ì¢‹ì•„ìš”.`;
  }

  function buildDescribeHtml(p) {
    if (!p) {
      return "ì–´ëŠ í–¥ì„ ë§í•˜ëŠ”ì§€ ì˜ ëª¨ë¥´ê² ì–´ìš”. ë²ˆí˜¸(ì˜ˆ: 3ë²ˆ)ë‚˜ ì´ë¦„ì„ ì¡°ê¸ˆ ë” ì •í™•íˆ ë§í•´ì¤„ë˜ìš”?";
    }
    let html = `<b>${p.name}</b> (${p.frName})<br><br>${p.story}<br><br><b>í–¥ì˜ êµ¬ì„±</b><br>${p.notes.join(", ")}`;
    if (p.reference) {
      html += `<br><br><b>ì°¸ê³ í–¥</b><br>${p.reference}`;
    }
    if (p.link) {
      html += `<br><a class="product-link" href="${p.link}" target="_blank">ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°</a>`;
    }
    return html;
  }

  function buildCompareHtml(p1, p2) {
    if (!p1 || !p2) {
      return "ë¹„êµí•  ë‘ í–¥ìˆ˜ë¥¼ ì¡°ê¸ˆ ë” ì •í™•íˆ ì•Œë ¤ì¤˜! ì˜ˆ: \"1ë²ˆì´ë‘ 12ë²ˆ ë¹„êµí•´ì¤˜\" ë˜ëŠ” \"ì˜¤í›„ 4ì‹œì˜ êµì‹¤ì´ë‘ ì¥ë§ˆì˜ ê¸°ì–µ ì°¨ì´ ì•Œë ¤ì¤˜\"";
    }
    return `
<b>${p1.name} vs ${p2.name}</b><br><br>
â€¢ <b>${p1.name}</b><br>${p1.story}<br>
í–¥ì˜ êµ¬ì„±: ${p1.notes.join(", ")}<br><br>
â€¢ <b>${p2.name}</b><br>${p2.story}<br>
í–¥ì˜ êµ¬ì„±: ${p2.notes.join(", ")}<br><br>
ëŠë‚Œìœ¼ë¡œ ì •ë¦¬í•˜ë©´,<br>
<b>${p1.name}</b>ëŠ” ${p1.mood.join(", ")} ìª½ì— ê°€ê¹ê³ ,<br>
<b>${p2.name}</b>ëŠ” ${p2.mood.join(", ")} ë¬´ë“œê°€ ë” ê°•í•´ìš”.<br>
ì§€ê¸ˆ ê¸°ë¶„ì— ë” ê°€ê¹Œìš´ ìª½ì„ ê³¨ë¼ë³´ëŠ” ê±¸ ì¶”ì²œí• ê²Œìš”. ğŸŒ¿
`;
  }

  function buildRecommendHtml(userText) {
    const ranked = scorePerfumes(userText);
    const best = ranked[0];
    const second = ranked[1];

    let html = `<b>ì´ëŸ° í–¥ì´ ì˜ ì–´ìš¸ë¦´ ê²ƒ ê°™ì•„ìš”.</b><br><br>`;
    html += `<b>${best.name}</b> (${best.frName})<br>${best.story}<br><br>`;
    html += `<b>í–¥ì˜ êµ¬ì„±</b><br>${best.notes.join(", ")}`;

    if (best.link) {
      html += `<br><a class="product-link" href="${best.link}" target="_blank">ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°</a>`;
    }

    if (second && second.score > 0) {
      html += `<br><br><b>ë‹¤ë¥¸ í›„ë³´</b><br>${second.name} (${second.frName})ë„ ì§€ê¸ˆ ë§í•œ ë¶„ìœ„ê¸°ì™€ ì˜ ì–´ìš¸ë ¤ìš”.`;
    }

    html += `<br><br>ë‹¤ë¥¸ ëŠë‚Œì´ ê¶ê¸ˆí•˜ë©´,<br>"ì¡°ê¸ˆ ë” ìƒí¼í•œ í–¥", "ì¢€ ë” ì”ì”í•œ í–¥" ì²˜ëŸ¼ ë‹¤ì‹œ ë§í•´ì¤˜ë„ ì¢‹ì•„ìš”.`;

    return html;
  }

  function detectIntent(text) {
    const t = text.toLowerCase();

    if (/ë¸Œëœë“œ\s*ì†Œê°œ|ë¸Œëœë“œ\s*ìŠ¤í† ë¦¬|ì¶”ì–µì˜\s*í–¥ìˆ˜\s*ë­|ë¬´ìŠ¨\s*ë¸Œëœë“œ/.test(t)) {
      return { type: "brand" };
    }

    if (/í–¥ìˆ˜\s*(ë¦¬ìŠ¤íŠ¸|ëª©ë¡)|ì „ì²´\s*í–¥ìˆ˜|ë¼ì¸ì—…/.test(t)) {
      return { type: "list" };
    }

    if (/ë¹„êµ|ì°¨ì´/.test(t)) {
      const nums = t.match(/(\d+)\s*ë²ˆ/g);
      let p1 = null, p2 = null;
      if (nums && nums.length >= 2) {
        const n1 = parseInt(nums[0], 10);
        const n2 = parseInt(nums[1], 10);
        p1 = perfumes.find(p => p.id === n1);
        p2 = perfumes.find(p => p.id === n2);
      } else {
        const parts = t.split(/ë‘|ê³¼|ì™€|vs|,|\/|\&/);
        if (parts.length >= 2) {
          p1 = findPerfumeByText(parts[0]);
          p2 = findPerfumeByText(parts[1]);
        }
      }
      return { type: "compare", p1, p2 };
    }

    if (/ì„¤ëª…|ì–´ë–¤\s*í–¥|ìì„¸íˆ/.test(t)) {
      const target = findPerfumeByText(t);
      return { type: "describe", perfume: target };
    }

    return { type: "recommend" };
  }

  function getBotReplyHtml(text) {
    const intent = detectIntent(text);

    if (intent.type === "brand")   return buildBrandIntroHtml();
    if (intent.type === "list")    return buildListHtml();
    if (intent.type === "describe")return buildDescribeHtml(intent.perfume);
    if (intent.type === "compare") return buildCompareHtml(intent.p1, intent.p2);
    return buildRecommendHtml(text);
  }

  // --- UI ë™ì‘ ë¶€ë¶„ ---
  const popup = document.getElementById("chat-popup");
  const launcher = document.getElementById("chat-launcher");
  const closeBtn = document.getElementById("chat-close");
  const chat = document.getElementById("chat-window");
  const input = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");
  const quickButtons = document.querySelectorAll(".quick-chip");

  function openChat() {
    popup.style.display = "flex";
  }

  function closeChat() {
    popup.style.display = "none";
  }

  launcher.onclick = () => {
    if (popup.style.display === "flex") closeChat();
    else openChat();
  };
  closeBtn.onclick = closeChat;

  function addMsg(text, who, isHtml=false) {
    const row = document.createElement("div");
    row.className = `msg-row ${who}`;
    const bubble = document.createElement("div");
    bubble.className = `msg-bubble ${who}`;

    if (isHtml) bubble.innerHTML = text;
    else bubble.textContent = text;

    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  function handleSend(rawText) {
    const text = rawText.trim();
    if (!text) return;

    addMsg(text, "user");
    input.value = "";

    setTimeout(() => {
      const replyHtml = getBotReplyHtml(text);
      addMsg(replyHtml, "bot", true);
    }, 350);
  }

  sendBtn.onclick = () => handleSend(input.value);
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") handleSend(input.value);
  });

  quickButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const t = btn.getAttribute("data-text");
      handleSend(t);
    });
  });

  addMsg("ì•ˆë…•, ì¶”ì–µì˜ í–¥ìˆ˜ ì±—ë´‡ì´ì—ìš”.\në– ì˜¬ë¦¬ê³  ì‹¶ì€ ìˆœê°„ì´ë‚˜ ê¸°ë¶„ì„ í¸í•˜ê²Œ ë§í•´ë³´ì„¸ìš”.", "bot");
</script>

</body>
</html>
