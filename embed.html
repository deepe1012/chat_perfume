<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Chatbot Embed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: Pretendard, sans-serif;
    }

    /* íŒì—… ë²„íŠ¼ */
    .chat-launcher {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      border: none;
      background: #d76da4;
      color: #fff;
      font-size: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
      z-index: 9999;
    }

    /* íŒì—… UI */
    .chat-popup {
      position: fixed;
      bottom: 84px;
      right: 20px;
      width: 360px;
      max-height: 560px;
      background: #fff;
      border-radius: 16px;
      border: 2px solid #f4d0e4;
      display: none;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,0.2);
      z-index: 9998;
    }

    .chat-header {
      padding: 10px 14px;
      background: #d76da4;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 14px;
    }

    .chat-window {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      background: #fffdfd;
    }

    .msg-row {
      margin-bottom: 10px;
      display: flex;
    }
    .msg-row.user { justify-content: flex-end; }

    .msg-bubble {
      padding: 10px 13px;
      max-width: 80%;
      border-radius: 12px;
      white-space: pre-line;
      font-size: 14px;
      line-height: 1.4;
    }

    .msg-bubble.user { background: #ffddee; border-bottom-right-radius: 2px; }
    .msg-bubble.bot  { background: #f7e8f3; border-bottom-left-radius: 2px; }

    .input-area {
      display: flex;
      border-top: 1px solid #f0d5e5;
      background: #fff;
    }

    .input-area input {
      flex: 1;
      padding: 10px;
      border: none;
      font-size: 14px;
      outline: none;
    }

    .input-area button {
      width: 80px;
      border: none;
      background: #d76da4;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<button class="chat-launcher" id="chat-launcher">ğŸ’¬</button>

<div class="chat-popup" id="chat-popup">
  <div class="chat-header">
    <span>í–¥ìˆ˜ ì¶”ì²œ ì±—ë´‡</span>
    <button class="chat-header-close" id="chat-close" style="background:none;border:none;color:#fff;font-size:18px;cursor:pointer;">Ã—</button>
  </div>

  <div id="chat-window" class="chat-window"></div>

  <div class="input-area">
    <input id="user-input" placeholder="í–¥ ëŠë‚Œì„ ì ì–´ì£¼ì„¸ìš”" />
    <button id="send-btn">ì „ì†¡</button>
  </div>
</div>

<script>
  // === í–¥ìˆ˜ ë°ì´í„° ===
  const perfumes = [
    { id:1, name:"01 First Memory",  keywords:["ìƒí¼","ì‹œíŠ¸ëŸ¬ìŠ¤","ë ˆëª¬","ì‚°ëœ»"], notes:["ë ˆëª¬","ë² ë¥´ê°€ëª»","ì‹œíŠ¸ëŸ¬ìŠ¤"] },
    { id:2, name:"02 Sweet Room",    keywords:["ë‹¬ì½¤","ë°”ë‹ë¼","ë¶€ë“œëŸ¬ìš´","í¬ê·¼"], notes:["ë°”ë‹ë¼","ë¨¸ìŠ¤í¬","ì¹´ë¼ë©œ"] },
    { id:3, name:"03 Rainy Day",     keywords:["ì‹œì›","ë§‘ì€","ë¹„ëˆ„í–¥","ì²­ëŸ‰","ê¹¨ë—"], notes:["ë¹„ëˆ„","í™”ì´íŠ¸ë¨¸ìŠ¤í¬"] },
    { id:4, name:"04 Wood Ground",   keywords:["ìš°ë””","ë‚˜ë¬´í–¥","ë¬µì§","ìŠ¤ëª¨í‚¤","ê¹Šì€"], notes:["ìƒŒë‹¬ìš°ë“œ","ì‹œë”","íŒŒì¶œë¦¬"] },
    { id:5, name:"05 Pink Mood",     keywords:["í”Œë¡œëŸ´","ê½ƒí–¥","ë¡œë§¨í‹±","ë¶€ë“œëŸ¬ì›€"], notes:["ì¥ë¯¸","ììŠ¤ë¯¼","í”¼ì˜¤ë‹ˆ"] },
    { id:6, name:"06 Fresh Day",     keywords:["ê³¼ì¼í–¥","ìƒí¼","ë‹¬ë‹¬","í†¡í†¡"], notes:["ë³µìˆ­ì•„","ë² ë¦¬","ì‚¬ê³¼"] },
    { id:7, name:"07 Deep Amber",    keywords:["ì— ë²„","ë¬µì§","ë”°ëœ»í•¨","ì„¹ì‹œ","ë†ë°€"], notes:["ì•°ë²„","íŒŒì¶œë¦¬"] },
    { id:8, name:"08 Soft Clean",    keywords:["ë¹„ëˆ„í–¥","ì½”íŠ¼","í¬ê·¼","ê¹”ë”","ì”ì”"], notes:["ì½”íŠ¼","í™”ì´íŠ¸ë¨¸ìŠ¤í¬","ë¦°ë„¨"] },
    { id:9, name:"09 Night Walk",    keywords:["ì”ì”","ê³ ìš”","ì°¨ë¶„","ì€ì€"], notes:["ì•„ì´ë¦¬ìŠ¤","í‹°","ë¨¸ìŠ¤í¬"] },
    { id:10,name:"10 Sunset Moment", keywords:["ë”°ëœ»","ë…¸ì„","ê°ì„±","í¸ì•ˆ"], notes:["ì˜¤ë Œì§€","ë°”ë‹ë¼","ë¨¸ìŠ¤í¬"] }
  ];

  const synonymGroups = {
    "ìƒí¼": ["ìƒí¼","ìƒì¾Œ","ì‚°ëœ»","ì‹œíŠ¸ëŸ¬ìŠ¤","ë ˆëª¬ëŠë‚Œ"],
    "ë‹¬ì½¤": ["ë‹¬ì½¤","ë‹¬ë‹¬","ìŠ¤ìœ—","ë””ì €íŠ¸í–¥"],
    "ë¶€ë“œëŸ¬ì›€":["ë¶€ë“œëŸ¬ì›€","ë¶€ë“œëŸ¬ìš´","í¬ê·¼","ì†Œí”„íŠ¸"],
    "ë¹„ëˆ„í–¥":["ë¹„ëˆ„","ì†","ìƒ¤ì›Œí›„í–¥","ë¹„ëˆ„í–¥"],
    "ìš°ë””":["ìš°ë””","ë‚˜ë¬´","ìš°ë“œ","ìŠ¤ëª¨í‚¤","ë¬µì§"],
    "ë”°ëœ»":["ë”°ëœ»","ì›œ","í¬ê·¼í•œë”°ëœ»","ë…¸ì„"],
    "í”Œë¡œëŸ´":["ê½ƒ","ê½ƒí–¥","í”Œë¡œëŸ´","í”Œë¡œë„"],
    "ê¹¨ë—":["ê¹¨ë—","í´ë¦°","ì²­ëŸ‰","ê¹”ë”"]
  };

  function cleanText(t) { return t.replace(/\s+/g,"").toLowerCase(); }

  function matchSynonym(text, keyword) {
    for (const key in synonymGroups) {
      if (synonymGroups[key].includes(keyword)) {
        if (synonymGroups[key].some(w => text.includes(w))) return true;
      }
    }
    return false;
  }

  function getScores(userText) {
    const text = cleanText(userText);

    return perfumes.map(p => {
      let score = 0;

      p.keywords.forEach(k => {
        if (text.includes(k)) score += 4;
        if (matchSynonym(text, k)) score += 3;
      });

      p.notes.forEach(n => {
        if (text.includes(n)) score += 3;
        if (matchSynonym(text, n)) score += 2;
      });

      return { ...p, score };
    }).sort((a,b) => b.score - a.score);
  }

  function recommend(text) {
    const list = getScores(text);
    if (list[0].score === 0)
      return "ì¡°ê¸ˆ ë” ìì„¸íˆ ë§í•´ì¤˜! (ì˜ˆ: ìƒí¼í•œ ê³¼ì¼í–¥, í¬ê·¼í•œ ë¹„ëˆ„í–¥ ë“±)";

    const a = list[0];
    const b = list[1];

    let msg = `"${a.name}" ì¶”ì²œ!\n`;
    if (b && b.score > 0) msg += `"${b.name}"ë„ ì˜ ë§ì„ ê²ƒ ê°™ì•„.`;
    return msg;
  }

  // === UI ===
  const popup = document.getElementById("chat-popup");
  const launcher = document.getElementById("chat-launcher");
  const closeBtn = document.getElementById("chat-close");
  const chat = document.getElementById("chat-window");
  const input = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");

  launcher.onclick = () => popup.style.display = "flex";
  closeBtn.onclick = () => popup.style.display = "none";

  sendBtn.onclick = send;
  input.addEventListener("keydown", e => { if (e.key === "Enter") send(); });

  function send() {
    const text = input.value.trim();
    if (!text) return;

    addMsg(text, "user");
    input.value = "";
    const reply = recommend(text);
    setTimeout(() => addMsg(reply, "bot"), 150);
  }

  function addMsg(text, who) {
    const row = document.createElement("div");
    row.classList.add("msg-row", who);

    const bubble = document.createElement("div");
    bubble.classList.add("msg-bubble", who);
    bubble.textContent = text;

    row.appendChild(bubble);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  addMsg("ì•ˆë…•! ì›í•˜ëŠ” í–¥ ëŠë‚Œì„ ì•Œë ¤ì¤˜!", "bot");
</script>

</body>
</html>
